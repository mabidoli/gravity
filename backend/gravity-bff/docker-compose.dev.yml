version: '3.8'

# Development environment override
# Usage: docker-compose -f docker-compose.yml -f docker-compose.dev.yml up

services:
  api:
    build:
      context: .
      dockerfile: Dockerfile
      target: builder
    container_name: gravity_api_dev
    command: go run ./cmd/api/main.go
    volumes:
      - .:/app
      - go_mod_cache:/go/pkg/mod
    ports:
      - "${API_PORT:-8080}:8080"
    env_file:
      - .env
    environment:
      - DB_HOST=db
      - REDIS_HOST=cache
      - GO111MODULE=on
    depends_on:
      - db
      - cache
    networks:
      - gravity_net

  db:
    ports:
      - "5432:5432"

  cache:
    ports:
      - "6379:6379"

volumes:
  go_mod_cache:
